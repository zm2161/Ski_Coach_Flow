# ğŸ³ Dockerfile æµ‹è¯•æŒ‡å—

## Dockerfile éªŒè¯ç»“æœ

### âœ… åŸºæœ¬ç»“æ„æ£€æŸ¥

- âœ… **åŸºç¡€é•œåƒ**: `node:18-slim` - è½»é‡çº§ Node.js 18
- âœ… **FFmpeg å®‰è£…**: å·²åŒ…å«ï¼ˆè§†é¢‘å¤„ç†å¿…éœ€ï¼‰
- âœ… **å·¥ä½œç›®å½•**: `/app` å·²è®¾ç½®
- âœ… **ä¾èµ–å®‰è£…**: ä½¿ç”¨ `npm ci --only=production`ï¼ˆå¿«é€Ÿä¸”å¯é ï¼‰
- âœ… **ä»£ç å¤åˆ¶**: å¤åˆ¶æ‰€æœ‰åº”ç”¨æ–‡ä»¶
- âœ… **ä¸Šä¼ ç›®å½•**: `uploads/` ç›®å½•å·²åˆ›å»º
- âœ… **ç«¯å£æš´éœ²**: `EXPOSE 8000`
- âœ… **å¯åŠ¨å‘½ä»¤**: `CMD sh -c "node server.js"`ï¼ˆä½¿ç”¨ shell formï¼Œç¡®ä¿ PORT ç¯å¢ƒå˜é‡æ­£ç¡®æ‰©å±•ï¼‰

### âœ… å…³é”®ç‰¹æ€§

1. **PORT ç¯å¢ƒå˜é‡æ”¯æŒ**
   - Dockerfile ä½¿ç”¨ shell form (`sh -c`)ï¼Œç¡®ä¿ç¯å¢ƒå˜é‡æ­£ç¡®æ‰©å±•
   - `server.js` ä½¿ç”¨ `process.env.PORT || 8000`ï¼Œå…¼å®¹ Koyeb çš„åŠ¨æ€ç«¯å£

2. **FFmpeg æ”¯æŒ**
   - åœ¨ Dockerfile ä¸­å®‰è£… FFmpeg
   - æ”¯æŒè§†é¢‘å¤„ç†å’Œå…³é”®å¸§æå–

3. **ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–**
   - ä½¿ç”¨ `npm ci --only=production`ï¼ˆä¸å®‰è£… devDependenciesï¼‰
   - æ¸…ç† apt ç¼“å­˜ï¼Œå‡å°é•œåƒå¤§å°

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³• 1: ä½¿ç”¨ Dockerï¼ˆå¦‚æœå·²å®‰è£…ï¼‰

```bash
# 1. æ„å»ºé•œåƒ
docker build -t flo-ski-coach-test .

# 2. è¿è¡Œå®¹å™¨ï¼ˆæµ‹è¯• PORT ç¯å¢ƒå˜é‡ï¼‰
docker run -p 8000:8000 \
  -e PORT=8000 \
  -e GEMINI_API_KEY=your_api_key_here \
  flo-ski-coach-test

# 3. åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•
curl http://localhost:8000
```

### æ–¹æ³• 2: ä½¿ç”¨éªŒè¯è„šæœ¬

```bash
# è¿è¡ŒéªŒè¯è„šæœ¬ï¼ˆä¸éœ€è¦ Dockerï¼‰
./test-dockerfile.sh
```

### æ–¹æ³• 3: è¯­æ³•æ£€æŸ¥

```bash
# æ£€æŸ¥ Dockerfile è¯­æ³•ï¼ˆéœ€è¦ hadolintï¼‰
hadolint Dockerfile
```

## ğŸ“‹ é¢„æœŸè¡Œä¸º

### æ„å»ºé˜¶æ®µ

1. âœ… ä¸‹è½½ Node.js 18-slim åŸºç¡€é•œåƒ
2. âœ… å®‰è£… FFmpeg
3. âœ… å¤åˆ¶ package.json å’Œ package-lock.json
4. âœ… è¿è¡Œ `npm ci --only=production`
5. âœ… å¤åˆ¶åº”ç”¨ä»£ç 
6. âœ… åˆ›å»º uploads ç›®å½•

### è¿è¡Œé˜¶æ®µ

1. âœ… å®¹å™¨å¯åŠ¨æ—¶ï¼ŒKoyeb ä¼šè®¾ç½® `PORT` ç¯å¢ƒå˜é‡
2. âœ… `server.js` è¯»å– `process.env.PORT`ï¼ˆæˆ–ä½¿ç”¨é»˜è®¤å€¼ 8000ï¼‰
3. âœ… æœåŠ¡å™¨ç›‘å¬ `0.0.0.0:${PORT}`
4. âœ… åº”ç”¨å¯ä»¥é€šè¿‡ `https://flo-ski-coach.ai-builders.space` è®¿é—®

## ğŸ” éªŒè¯æ£€æŸ¥æ¸…å•

- [x] Dockerfile å­˜åœ¨ä¸”è¯­æ³•æ­£ç¡®
- [x] ä½¿ç”¨ shell form (`sh -c`) ç¡®ä¿ç¯å¢ƒå˜é‡æ‰©å±•
- [x] FFmpeg å·²å®‰è£…
- [x] ç«¯å£æ­£ç¡®æš´éœ²ï¼ˆ8000ï¼‰
- [x] server.js è¯»å– PORT ç¯å¢ƒå˜é‡
- [x] é™æ€æ–‡ä»¶æœåŠ¡é…ç½®æ­£ç¡®
- [x] ç¯å¢ƒå˜é‡ï¼ˆGEMINI_API_KEYï¼‰å¯ä»¥é€šè¿‡ `env_vars` ä¼ é€’

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: PORT ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

**åŸå› **: CMD ä½¿ç”¨ exec form (`CMD ["node", "server.js"]`) è€Œä¸æ˜¯ shell form

**è§£å†³**: ä½¿ç”¨ `CMD sh -c "node server.js"`ï¼ˆå·²åœ¨ Dockerfile ä¸­å®ç°ï¼‰

### é—®é¢˜ 2: FFmpeg æœªæ‰¾åˆ°

**åŸå› **: FFmpeg æœªå®‰è£…æˆ–è·¯å¾„ä¸æ­£ç¡®

**è§£å†³**: Dockerfile ä¸­å·²åŒ…å« FFmpeg å®‰è£…æ­¥éª¤

### é—®é¢˜ 3: ä¾èµ–å®‰è£…å¤±è´¥

**åŸå› **: package-lock.json ä¸å­˜åœ¨æˆ–è¿‡æ—¶

**è§£å†³**: è¿è¡Œ `npm install` ç”Ÿæˆ package-lock.json

## ğŸ“ éƒ¨ç½²åˆ° AI Builder åçš„éªŒè¯

éƒ¨ç½²å®Œæˆåï¼Œæ£€æŸ¥ï¼š

1. **å¥åº·æ£€æŸ¥**: è®¿é—® `https://flo-ski-coach.ai-builders.space`
2. **API ç«¯ç‚¹**: æµ‹è¯• `/api/upload` ç«¯ç‚¹
3. **é™æ€æ–‡ä»¶**: ç¡®è®¤å‰ç«¯é¡µé¢æ­£å¸¸åŠ è½½
4. **ç¯å¢ƒå˜é‡**: ç¡®è®¤ `GEMINI_API_KEY` æ­£ç¡®ä¼ é€’

## ğŸ¯ æ€»ç»“

Dockerfile å·²é€šè¿‡éªŒè¯ï¼Œç¬¦åˆ AI Builder éƒ¨ç½²è¦æ±‚ï¼š

- âœ… ä½¿ç”¨ shell form ç¡®ä¿ PORT ç¯å¢ƒå˜é‡æ­£ç¡®æ‰©å±•
- âœ… åŒ…å«æ‰€æœ‰å¿…éœ€çš„ä¾èµ–ï¼ˆNode.jsã€FFmpegï¼‰
- âœ… ä¼˜åŒ–äº†ç”Ÿäº§ç¯å¢ƒæ„å»º
- âœ… ç¬¦åˆå•è¿›ç¨‹/å•ç«¯å£è¦æ±‚

å¯ä»¥ç›´æ¥ç”¨äº AI Builder éƒ¨ç½²ï¼

