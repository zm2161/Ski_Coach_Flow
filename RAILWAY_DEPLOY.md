# Railway éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°† Flo åç«¯éƒ¨ç½²åˆ° Railwayã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

1. **Railway è´¦å·**
   - è®¿é—® [railway.app](https://railway.app)
   - ä½¿ç”¨ GitHub è´¦å·ç™»å½•ï¼ˆæ¨èï¼‰

2. **GitHub ä»“åº“**
   - ç¡®ä¿ä»£ç å·²æ¨é€åˆ° GitHub
   - Railway éœ€è¦ä» GitHub éƒ¨ç½²

3. **ç¯å¢ƒå˜é‡**
   - `GEMINI_API_KEY`: Google Gemini API å¯†é’¥

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»º Railway é¡¹ç›®

1. ç™»å½• [Railway Dashboard](https://railway.app/dashboard)
2. ç‚¹å‡» **"New Project"**
3. é€‰æ‹© **"Deploy from GitHub repo"**
4. é€‰æ‹©æ‚¨çš„ GitHub ä»“åº“
5. Railway ä¼šè‡ªåŠ¨æ£€æµ‹ Node.js é¡¹ç›®

### æ­¥éª¤ 2: é…ç½®ç¯å¢ƒå˜é‡

1. åœ¨ Railway é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡»æ‚¨çš„æœåŠ¡
2. æ‰“å¼€ **"Variables"** æ ‡ç­¾
3. æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```
GEMINI_API_KEY=ä½ çš„_Gemini_API_å¯†é’¥
NODE_ENV=production
```

### æ­¥éª¤ 3: é…ç½®æ„å»ºè®¾ç½®ï¼ˆå¯é€‰ï¼‰

Railway ä¼šè‡ªåŠ¨æ£€æµ‹ `nixpacks.toml` æ–‡ä»¶ï¼Œç¡®ä¿ FFmpeg å¯ç”¨ã€‚

å¦‚æœè‡ªåŠ¨æ£€æµ‹å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼š
- **Build Command**: `npm ci`
- **Start Command**: `npm start`

### æ­¥éª¤ 4: è·å–å…¬å…± URL

1. éƒ¨ç½²å®Œæˆåï¼ŒRailway ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå…¬å…± URL
2. æ ¼å¼ç±»ä¼¼ï¼š`https://your-app-name.up.railway.app`
3. åœ¨é¡¹ç›®è®¾ç½®ä¸­ï¼Œå¯ä»¥è®¾ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

### æ­¥éª¤ 5: æ›´æ–°å‰ç«¯é…ç½®

æ›´æ–° Vercel å‰ç«¯ï¼Œä½¿ç”¨ Railway åç«¯ URLï¼š

1. åœ¨ Vercel å‰ç«¯ URL ä¸­æ·»åŠ  `apiBase` å‚æ•°ï¼š
   ```
   https://your-vercel-app.vercel.app/?apiBase=https://your-app-name.up.railway.app
   ```

2. æˆ–è€…æ›´æ–° `landing.js` ä¸­çš„é»˜è®¤ API_BASEï¼ˆå¦‚æœéœ€è¦ï¼‰

## ğŸ”§ é…ç½®è¯´æ˜

### nixpacks.toml

è¿™ä¸ªæ–‡ä»¶å‘Šè¯‰ Railway å¦‚ä½•æ„å»ºæ‚¨çš„åº”ç”¨ï¼š
- å®‰è£… Node.js 18
- å®‰è£… FFmpegï¼ˆè§†é¢‘å¤„ç†å¿…éœ€ï¼‰
- è¿è¡Œ `npm ci` å®‰è£…ä¾èµ–
- è¿è¡Œ `npm start` å¯åŠ¨æœåŠ¡

### server.js ä¿®æ”¹

- âœ… ç§»é™¤äº† Vercel ç‰¹å®šé€»è¾‘
- âœ… æ”¯æŒ Railway çš„ PORT ç¯å¢ƒå˜é‡
- âœ… FFmpeg å§‹ç»ˆå¯ç”¨ï¼ˆRailway æä¾›ï¼‰
- âœ… CORS é…ç½®æ”¯æŒ Vercel å‰ç«¯

## ğŸ§ª æµ‹è¯•éƒ¨ç½²

1. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**
   ```bash
   curl https://your-app-name.up.railway.app/api/video/test
   ```
   åº”è¯¥è¿”å›ï¼š`{"error":"æœªæ‰¾åˆ°è§†é¢‘"}`ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰

2. **æµ‹è¯• CORS é¢„æ£€**
   ```bash
   curl -X OPTIONS \
     -H "Origin: https://your-vercel-app.vercel.app" \
     -H "Access-Control-Request-Method: POST" \
     https://your-app-name.up.railway.app/api/upload \
     -I
   ```
   åº”è¯¥è¿”å› 204 çŠ¶æ€ç å’Œ CORS å¤´

3. **åœ¨å‰ç«¯æµ‹è¯•ä¸Šä¼ **
   - è®¿é—® Vercel å‰ç«¯ URLï¼Œæ·»åŠ  `?apiBase=https://your-app-name.up.railway.app`
   - å°è¯•ä¸Šä¼ è§†é¢‘
   - æ£€æŸ¥å³ä¸Šè§’æŒ‡ç¤ºå™¨åº”ä¸ºç»¿è‰²

## ğŸ“ å¸¸è§é—®é¢˜

### Q: FFmpeg ä¸å¯ç”¨ï¼Ÿ
**A**: ç¡®ä¿ `nixpacks.toml` æ–‡ä»¶å­˜åœ¨ä¸”æ­£ç¡®ã€‚Railway ä¼šè‡ªåŠ¨å®‰è£… FFmpegã€‚

### Q: ç«¯å£é”™è¯¯ï¼Ÿ
**A**: Railway è‡ªåŠ¨è®¾ç½® `PORT` ç¯å¢ƒå˜é‡ï¼Œä»£ç å·²æ”¯æŒã€‚

### Q: CORS é”™è¯¯ï¼Ÿ
**A**: æ£€æŸ¥ `server.js` ä¸­çš„ `allowedOrigins` æ•°ç»„ï¼Œç¡®ä¿åŒ…å«æ‚¨çš„ Vercel å‰ç«¯ URLã€‚

### Q: ç¯å¢ƒå˜é‡æœªåŠ è½½ï¼Ÿ
**A**: ç¡®ä¿åœ¨ Railway é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ äº†æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡ã€‚

### Q: éƒ¨ç½²å¤±è´¥ï¼Ÿ
**A**: æ£€æŸ¥ Railway æ—¥å¿—ï¼š
1. åœ¨ Railway Dashboard ä¸­æ‰“å¼€æ‚¨çš„æœåŠ¡
2. æŸ¥çœ‹ **"Deployments"** æ ‡ç­¾
3. ç‚¹å‡»å¤±è´¥çš„éƒ¨ç½²æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

## ğŸ”„ æ›´æ–°éƒ¨ç½²

æ¯æ¬¡æ¨é€åˆ° GitHub ä¸»åˆ†æ”¯ï¼ŒRailway ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ã€‚

ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼š
1. åœ¨ Railway Dashboard ä¸­
2. ç‚¹å‡» **"Redeploy"**

## ğŸ“Š ç›‘æ§

Railway æä¾›ï¼š
- **å®æ—¶æ—¥å¿—**: åœ¨ Dashboard ä¸­æŸ¥çœ‹
- **æŒ‡æ ‡**: CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ
- **éƒ¨ç½²å†å²**: æŸ¥çœ‹æ‰€æœ‰éƒ¨ç½²è®°å½•

## ğŸ’° è´¹ç”¨

Railway æä¾›ï¼š
- **å…è´¹é¢åº¦**: $5/æœˆï¼ˆé€šå¸¸è¶³å¤Ÿå°å‹é¡¹ç›®ï¼‰
- **æŒ‰ä½¿ç”¨ä»˜è´¹**: è¶…å‡ºå…è´¹é¢åº¦åæŒ‰å®é™…ä½¿ç”¨è®¡è´¹

## ğŸ‰ å®Œæˆï¼

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„åç«¯å°†åœ¨ Railway ä¸Šè¿è¡Œï¼Œå‰ç«¯å¯ä»¥é€šè¿‡ `apiBase` å‚æ•°è¿æ¥åˆ°å®ƒã€‚

